worker_rlimit_nofile 8192;

events {
  worker_connections  4096;
}

http {
    sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 8192;
	server_tokens off;
	server_name_in_redirect off;
	default_type application/octet-stream;

    server {
        listen                    28180 ssl http2 default_server;
        listen                    [::]:28180 ssl http2 default_server;
        server_name               localhost;

        add_header                Strict-Transport-Security "max-age=31536000" always;

        ssl_session_cache         shared:SSL:20m;
        ssl_session_timeout       10m;

        ssl_protocols             TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers               "ECDH+AESGCM:ECDH+AES256:ECDH+AES128:!ADH:!AECDH:!MD5;";

        ssl_stapling              on;
        ssl_stapling_verify       on;
        resolver                  8.8.8.8 8.8.4.4;

        ssl_certificate           /etc/nginx/root-ca.pem;
        ssl_certificate_key       /etc/nginx/root-ca.key;

        access_log                /var/log/nginx/access_medcat-1-2.log;
        error_log                 /var/log/nginx/error_medcat-1-2.log;

        location / {
            include cors.conf;
            proxy_pass         http://medcat-1-2:8000/;
            proxy_set_header   Host $host;
        }
    }

    server {
        listen                    28181 ssl http2 default_server;
        listen                    [::]:28181 ssl http2 default_server;
        server_name               localhost;

        add_header                Strict-Transport-Security "max-age=31536000" always;

        ssl_session_cache         shared:SSL:20m;
        ssl_session_timeout       10m;

        ssl_protocols             TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers               "ECDH+AESGCM:ECDH+AES256:ECDH+AES128:!ADH:!AECDH:!MD5;";

        ssl_stapling              on;
        ssl_stapling_verify       on;
        resolver                  8.8.8.8 8.8.4.4;

        ssl_certificate           /etc/nginx/root-ca.pem;
        ssl_certificate_key       /etc/nginx/root-ca.key;

        access_log                /var/log/nginx/access_medcat-1-2-icd10.log;
        error_log                 /var/log/nginx/error_medcat-1-2-icd10.log;

        location / {
            include cors.conf;
            proxy_pass         http://medcat-1-2-icd10:8000/;
            proxy_set_header   Host $host;
        }
    }

    server {
        listen                    28182 ssl http2 default_server;
        listen                    [::]:28182 ssl http2 default_server;
        server_name               localhost;

        add_header                Strict-Transport-Security "max-age=31536000" always;

        ssl_session_cache         shared:SSL:20m;
        ssl_session_timeout       10m;

        ssl_protocols             TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers               "ECDH+AESGCM:ECDH+AES256:ECDH+AES128:!ADH:!AECDH:!MD5;";

        ssl_stapling              on;
        ssl_stapling_verify       on;
        resolver                  8.8.8.8 8.8.4.4;

        ssl_certificate           /etc/nginx/root-ca.pem;
        ssl_certificate_key       /etc/nginx/root-ca.key;

        access_log                /var/log/nginx/access_de-identification.log;
        error_log                 /var/log/nginx/error_de-identification.log;

        location / {
            include cors.conf;
            proxy_pass         http://de-identification:8000/;
            proxy_set_header   Host $host;
        }
    }

    server {
        listen                    28200 ssl http2 default_server;
        listen                    [::]:28200 ssl http2 default_server;
        server_name               localhost;

        add_header                Strict-Transport-Security "max-age=31536000" always;

        ssl_session_cache         shared:SSL:20m;
        ssl_session_timeout       10m;

        ssl_protocols             TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers               "ECDH+AESGCM:ECDH+AES256:ECDH+AES128:!ADH:!AECDH:!MD5;";

        ssl_stapling              on;
        ssl_stapling_verify       on;
        resolver                  8.8.8.8 8.8.4.4;

        ssl_certificate           /etc/nginx/root-ca.pem;
        ssl_certificate_key       /etc/nginx/root-ca.key;

        access_log                /var/log/nginx/access_medcat-1-2.log;
        error_log                 /var/log/nginx/error_medcat-1-2.log;

        location / {
            include cors.conf;
            proxy_pass         http://mlflow-ui:5000;
            proxy_set_header   Host $host;
        }
    }
}